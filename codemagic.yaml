# Based on https://codemagic.io/app/5fc5305a253cd4a4babce97d/settings

workflows:
  default-workflow:
    name: Default Workflow
    max_build_duration: 60
    environment:
      flutter: stable
      xcode: latest
      cocoapods: default
      vars:
        FCI_KEYSTORE_PATH: /tmp/keystore.keystore
        FCI_KEYSTORE: Encrypted(Z0FBQUFBQmYwcnRfYnEzUTVQOFdPa20tUFZsN2YxTlRBbnRLTWVodnVMbnVPdUt6ZVB6V0ZZbnZRQVYyR0g5clpKTjRBeTgyeDZ5SHdIbVMwREcwTGpvcDNLZkJZdkVqWVRxal83OThhVTQ2NXdWY2VwSEVOVFJBaTh6TTRBQVNiTjBWMUlheUszMzBhSE1EOWw3N3hrLXR4V2RGQXk5UUZ5OGtBX2FmM3MtcE94WUtKalo0NUF3QWdBYXhobkxSYzhlck1iNUFiQlFCVnExZjRYYW5TRVNEdVRhNVBzY3dDN3JqSDRKREZHNktNQ3pJSlNGc0QwT2h0WG9NcDF0aWpOYmQ1VzVFMzUzalRpWlZJeFhkQ1h3eHB1TlNGRFhUTkdFZkpIQXJCZG8wMjhuTXlET2lQUDBibEFqYXRNbE1MRGlVN2pkWXNZaGdPS3dUUmxZVkZqMVUzb2hKM2Q5b0VhdUdWVmNqT2lDN2ZXamc3ZXNtT3NJU2JndE9fdllJVkIwY01GNFV6dXlETVAySlRvSVp4VHVTSFJmcVRNajhScTE3T2xPeUF1LVZNN1N0ZHg4UFdEbkNveTE4eElXZVF3clF4cVZHcGtvTkYzeHNqQk9zNy10UlZacmdNbVVvTEJnQXVybEhHWk9TV2kxRFVZajkzMGNHRlFhNzk4NmQySEFKYlVwUGp3YkdLN3MyOFI2OW8wRnBZZ3BYYmhUTEwtTWdMa1UxUFpROE45aUlUZ1YtNWJPTG83WlFqU2NwRUJOZzItRDRkZy1xNEw0M0syMUQwWFQxdWZ2OXluWTZyUFhqSWxsd0s1cG1tU3o5S3lXcUIydFRYWnV4Z0JGNmZoSV93WFVBZngyeFNQdU1pNmdqZzc3eW1yQ3J1T2l5MDJGXzc5NnJET29JZkpXUmM1MXhaYm9VODNPOFpYa0FpOFFkVVRUUGZpNnAydEZxeHJuSmRDZnZzZmRNamY0UGI1a2pLWUxvblJvSFFWU01sTnJHdUt3cFE2eUh1Q2JfUFdnZHBEVHZTOWFnZmdTc2pJZ3RYeEp4NUtQdm9XQVBwUWZrX0RNV05xMzJqRnVZcmJKeUZKbXp1ZDJhOVdSWlNnTk40MUdvXzRFVk1jSTN1UVg2b1JLdkdVaFNENHc5U195cTA4eVRDNDJZSlMtTk53M0dqSUdKRDUzUkloODBuZjUyZEFqNEdKbXp4aGdhMkFDVkI4ZWJUNGhGRm94OFFDWXJOT1E0Qjh4T2Z4M0s5OE9tV3RGcE51Uld6TjFDUHFEUjFObHRoczZ1ekFYZ1lGUS1FNmdWYmJMd29ENXVMd1h2VVpBYlEzOEhzWjJwR1Juc2ZzRE1GX0U5Z3BESlZPaVh6UnNzQWtza2luZW9fRXR5a0FKcWZTb2pHYlBQeC02c1A2cmpsNkJYSjNuX1A1SmozMDZhS2V6ell4M3M2UGRISE1vbnY5QXgyLUVGdWNjM1RWMHpjTFhHNHRXOTByTjZfdUtDWkFvdUc2cWVkQk9oVHpNSjJVbTlOd09FMFNtMHM0dXM1b21aM1hVSC1CRTI3aDdldHBCU09xRkd4cjRsRTBxZTJReWM0OVo0Z1JVMXZhclBfWmJUSGRtMFRRdWs5d0JNR0VDZTVvcDhaTExkVDg5Q2ZzNHRNcXlTWVRHd2N6LW42cDgzTFNLNGtlaUNxM0dEcFZ6WWE5R1MwbUVNNVpjZk44RzZicTJrMm5RbWdXOExad1NpdFd2U1pCTlREckMtVjVTV285MWk4d0VQRlVTMWU0dk90MnZjbXF2LWI1b0JHcHRna2Rsd3NVWkZRMnRBTTVNcUZLTFhQWHFCazBpY1Z0N1pHS0VOZzVET0pLYnlqdXloVm1hSlpzT1BqXzltVWYyLVM3NnljWjd4VHMteUpqNEktN01FY3hkTVYzRXRyaDdBZWJlenM2ODlrQVR0TnNmZ3Q5TzFCTm5jY3lpd0JoaUJlUkRxTGJuQnV0X3c3ZXdjdTRhbTB5N2xsY1ZWQzRIbGFsRG8zNlpEZE9lcUVlczNmRW5udDB6Q29OUVlkLW1YaWkydjZ0UXFGbGpuSURWTzhRb0VpR184SkxjQWxWUWFVX2pQdEpfZ19IVmZYdDFfN0taM2dRV2xYZUhDd2hHLTVFTkdRYlRkYzBleTRWLUk4NEd2YnllTXhGMHRWM2ExSlNuVWM4YXdyeW13VUdMV1YtMlRWYlNNWV9ZVHpiTEFOeVpGaGZxdVNOTGNGUEN0U2JtLTFWODlEV1oxLWM1TDFRTTk1VjhoSGRRbmZGVjFyREQwNW9RVzlFN2UtX2M0ZnY0NklxQm9vZmVNVjU4b01ZeEJqeDVSYzNlWGEyWmttejNfcHFSMFhfbDJseERqQVV3aTN4QTRJbHBKSnZGOElBLUhvaF96WURRVmJuNVhTTzFjRVN4S1ZFNlotNmdYcmFJaDliaWlCX2ZXaDJzemNBVWVrNjVhN1FJd0I2OUh6dmlxdjgweHA1TmhUWHVXUFdwcUh3N0s4RmxvYnFnUmZqc2tGMG1GSE5GOTRCamo5Ym9EVjBpamxYQi1kT2NNOFFaUHJ6REdEeTlOaF9BUU4xWGZxNG9UdEVPdjQ4dWFvQ1p6WFFRcVRvU2FDcmhaczA1ajRDNkxEY0ZPdE90S204ckg1eFM0S2hFTUhmRllnSEF2SEYtdGZWVDdQcTY3N3JSVUhyODl0SVhCbURrLU9PRVFhVkE5NDBSZ2duLWQ1Y3Q5VHFfS0xOTmo3S2hDTjlGZzlfS1p4U1A1NTBQMnNhOW8xeFoweGFqU2FjOVktblNnMEwwTFJDRWY2MFFvb2RBd1p1U01vVEh4cWxjSENIejE2ZGpoSjE4aEZ1dlpETC0weHhuQ1AySzlWUHdmdGxHWVc5QUNSaGxrTWpwdEtpbmdNR2ZOa1NvdV9jWGVDRXhhcDRQUFpYcmgtb0J4SC1mOERaYXR4b0NJMVhQVGdGazVDRlAzU1JqRGNnQXk5ekhJMUdpUjBQTkVyNFpZSndmMGFpZ2l4UEl1eW5YaGdQalZzWk83dTllOVh5U3dCZHFMdkszdDZtMUFtR3E4MnZaZkx5V2c4LXhnQWFJbk9PWk10T2Z5TDFkdEdjdkJlbmt3NF9RQXcyNUpnUWRDRTBjSkc1YW01UWtVLVIzbVJxVnpaXzRNMmNRZHFSNkRtNGFyYUNoMHEwWGNGY2xIRjRzU3VPeWw2MUxRVjdaUVZxNUozSWxsb2d0eEZ4LUQ1bURkRWJRMzNfYklFalNSSFBpTkIxc0FZbDBhcW1qeW96NThWRDJnTnRvV0hrUFNLcjVseU1Gd1djZXY0S2RyT2V6ZFNGSmk0aWtGVmNLZkVBcWZlVUtlSHI5cXNhYVlZY0JpRmRYSmkxblZkVFMzRkFldExIa1Y5Qjl1bnNORWN2WWZoRkNtN2RwS1ZzbU41TkUtdEdSeVdZZTlaYW0yT1BnZjNHOE9ueERqbGZSSFlxNFVicjJrdDB5Z1RQOGNnblRSTVFlaHpKMHlCYzh0MERCRUNZR18yODNka1BOcEtnUnpJaE9wWndhckI0UWk4V3k1UmZ2cmpnVFFYT3JYZlNSR0ZsTW9VSlZpSjEwYUVXRTk4Y0VSYkI3bzZnR01fRjhSdmhjSlE5YVlqQUZmNi1XbkpqNFB5dWg5LWNkQWJxT3ZOYUhIR2hlOU9YckJBY1FsWFhSWmp6cFE2eXRGXzFoTEN0bHFHTmh4OTBoYm95UTRCY05yZS1aRXBmcU8xRjdvNm1LZkpmQWhWQUJ0Rk85NFpxU2Mzb2ppaV9PSGtESzhjNWl3V25pRjBFZ2UtbTJDWkotWUZrcmMxUEtFbVJJSXZUT01IV0ZKcmY0WVk5LUxYVHBaaVRxcFhGVi14OGl0N2E0b1ZzSWFHN3p2OVFHRVpDUFJLenJZVmY5cTBSOVBaS3A4LXE2X1Z3WDJqQVFJY3gyNGV6UXlDaVllMExYQzJ1RHBFUy1lR2s2YXdvMGVVQURjWHpDMER0VElSMnlrOGowc1RaZFBuOS1sR1ByeTBBUjZFRFVJN3AyTXNidzNTcktNZTVEeUVNX1g4RURMNTlJN3FUTi1Hb3g0ZnRDNHd3b3J2NzdfeWFJQVQ4MkNTalVoTVNJSHpibEFMM3hCSVVCakhYRldYbTlwZWRJSGFNNTN0Ym5ZaUtoZjFqakpicG1TazM1Sk5pSUsxNmVyV1Y4LU9rdjM4WEtDcDJzSEp3VHU0al9vN213alR1b0dwNGMzc3ZQVEpjSmtWT2FJZzRPVlQyWnNFWXo4OUpfUW14YVdfa1hGbEVwRE1UMVpvSEpuai0yWVJmU0NKaDN2eXRMUFJaRl9FcFJ0WkM2RUlwakR2T1RVTWt4cFNVZWxmN2dGY0k1TjQ4WXpFNERzSWphd1ZJdkVJMzBzQk5yNGZodU9maEE1UUtESkNobXpOcDZFN00zS0duaEQ3eExtVEphNGZWd3ZyTkFxajlPRHJLTE9BMl9OVkNuUWVGNTNHT1hwdUF3VGZvSl92bExJdjB5WkFZRUN0S1N3SzJibWJVYjUyaG1RRDBHWVFUQVM4UjhOLTRyMy1NalVHNW81QVduMTg2NXRhbmtHNnRRZmxmSXpreTRzcVFKQ1FfbnZHcFlyNVUtQ0pFZ0JIRmh3Q2tLMWhZZ1RtNVoxdzN1X24wMXdSZHZrTmM2V0lvTktSdy1iNnVoMFVvYzIwc1pUZFFRR0lFUTFmTWxTMjFzWUJTSzZ6YkhKVFVjZnM3OS1CTHItYnNGQ3ZKWXVWS0FtR3JyaHg2OVQ0NUUzcGZSQU5fMkVwaTBLUTc2OHBwd0NoZWdGUWxKNmhKeHNUT0NtTVpnM2dKZElEOXotU25ySk1ubmw5Nld1cElWRlcyak5BQWV6MHRvZEZhZTlqckhoUHNJbWNxbkdveVJxM2pRekpmRVR4blJGdWlJNTQ4aUlMMnlKeDc2dTFlM3I2aks5aThIQWo5eXdsZlBBUUlUZGd6RFE3YW1mX0wxYXl1dWRhMWdPX0RDdVRzTU84anltZkxOXzlKRlUwSUhHTHVMOG96b2hISC14YllSTEVIaUl1SEpoTXpTMGZKRmFGTjNZbXJydnliRU5DTGw3NTRXR2dWZUhpemJxazV2QUduUGh6NTVZZ2dXQ0Q2eVFrbzRSZXd3eUhJczd1S0lkLW5XcDBwd191SW9SaUJPZFNjQnFhemt2RVlWbFRDbDhJX1Z1QmhuamlCX1E1ZlJQMlRMMVNzSU1ETkV6RXpRNTI1dkVGcWRRRWF2ejdkQzRweDZLSGFrSVgzNEZ1UmVvU1lidE5pZk9oVjduOXhrQmdDeHByY2VNNXgxcWVISUQ2eWNqZ2lHSGFEMHpScUlNcGhDTGRVSmxHQ0F0Zk8tbzNmdTc2bVo5UzBUM2xTX0VKbHZFeWRDQ3VRbVNzaFlCVmhqVC1KOWtiSkx4MWViQWJITFNfYVUyX0h0dTZ0N1ZCU0l3cFpFbXJ5UTVranJ4a012RVlhX2t2MzRCSExJLVBCODdqTlYzX3ZpblFISnU=)
        FCI_KEYSTORE_PASSWORD: Encrypted(Z0FBQUFBQmYwcndhWkpndnpkZTlCTEFEVW02WlJjczFOcHZCMzhyZ2pUUGUzV2NYRTNhNEppVUtBbHFPQkRvZzZfeHhoZEp3TmgzZnFsMTZnODU1aUpDR3VHSDVZM1RMUlE9PQ==)
        FCI_KEY_ALIAS: Encrypted(Z0FBQUFBQmYwcng4VUxJQ2ZmcEp3eTRpeDZXQTg3TVE0QWNkdlRCZmRXY00ydjVmTW93c1g2dzBFTUhBdHN1YVhMT29laGFUc0tJb0RHNWZJZmdqZVpYUUJjZktNM2hUYmc9PQ==)
        FCI_KEY_PASSWORD: Encrypted(Z0FBQUFBQmYwcndhWkpndnpkZTlCTEFEVW02WlJjczFOcHZCMzhyZ2pUUGUzV2NYRTNhNEppVUtBbHFPQkRvZzZfeHhoZEp3TmgzZnFsMTZnODU1aUpDR3VHSDVZM1RMUlE9PQ==)
    triggering:
      events:
        - push
        - tag
      branch_patterns:
        - pattern: '*'
          include: true
          source: true
    scripts:
      - |
        # set up key.properties
        echo $FCI_KEYSTORE | base64 --decode > $FCI_KEYSTORE_PATH
        cat >> "$FCI_BUILD_DIR/android/key.properties" <<EOF
        storePassword=$FCI_KEYSTORE_PASSWORD
        keyPassword=$FCI_KEY_PASSWORD
        keyAlias=$FCI_KEY_ALIAS
        storeFile=/tmp/keystore.keystore
        EOF
      - |
        # set up local properties
        echo "flutter.sdk=$HOME/programs/flutter" > "$FCI_BUILD_DIR/android/local.properties"
      - cd . && flutter packages pub get
      - cd . && flutter pub global activate intl_utils
      - cd . && flutter pub global run intl_utils:generate
      - cd . && flutter analyze
      - cd . && flutter test
      - cd . && flutter build appbundle --build-number=$BUILD_NUMBER
      - find . -name "Podfile" -execdir pod install \;
      - cd . && flutter build ios --debug --no-codesign
    artifacts:
      - build/**/outputs/**/*.apk
      - build/**/outputs/**/*.aab
      - build/**/outputs/**/mapping.txt
      - build/ios/ipa/*.ipa
      - /tmp/xcodebuild_logs/*.log
      - flutter_drive.log
    publishing:
      email:
        recipients:
          - kristian@cavatina.no
        notify:
          success: false
          failure: true

